# SMART CONTRACT AUTOMATED TESTING GUIDELINES

## Forewords

The documents aim to recap my experience in smart contract automated testing besides the manual testing. I also put the issues that I faced during the execution, indeed, solutions are given.

## Connect with Remix from Local

For a complex project, you can't just copy paste the single sol file and let it run. To make our life easier, Remix has localhost connection which allows you to interact with your project in your local machine remotely.

This is something I'm used to doing when the project has a large number of inheritant contracts. Obviously, this make our life easier than ever by just downloading the git project and do some commands.

### Steps:

1. Go to WorkSpaces on the left panel and choose "Connect to Localhost"
2. The message box pops up and you just need to read carefully and copy the command shown in the box to connect your localhost

```remixd -s path-to-the-shared-folder --remix-ide remix-ide-instance-URL```

>Important: 
> The path-to-the-shared-folder: needs to be an absolute path
> The remix-ide-instance-URL: needs to plain with http or https

eg: ```remixd -s /home/enderphan/LOLToken/ --remix-ide http(s)://your-remix-address.com```

## Solc version problem

Source: https://github.com/crytic/solc-select

### Issues

You need to just switch the version of solc quickly by a command. The version of solc is kindda painful, depending on the tools and project, you need to use a specific and exact version to compile.. otherwise broke.

During my audit, I've suffered with solc-select installations. I used to install  via the shell command, but now they've upraded to pip3. The thing is that some docker containers do not support pip3, so you would need to install solc-selct into that docker but pip3. Therefore, I'v a copied version of the solc-select installed via shell.

### Installation

Via shell: https://github.com/enderphan94/solc-select-sh-version
Via Pip3: https://github.com/crytic/solc-select

## Tools

### 1. Slither

Source: https://github.com/crytic/slither

#### Features

* Detects vulnerable Solidity code with low false positives (see the list of [trophies](./trophies.md))
* Identifies where the error condition occurs in the source code
* Easily integrates into continuous integration and Truffle builds
* Built-in 'printers' quickly report crucial contract information
* Detector API to write custom analyses in Python
* Ability to analyze contracts written with Solidity >= 0.4
* Intermediate representation ([SlithIR](https://github.com/trailofbits/slither/wiki/SlithIR)) enables simple, high-precision analyses
* Correctly parses 99.9% of all public Solidity code
* Average execution time of less than 1 second per contract

#### How to install

Slither requires Python 3.6+ and [solc](https://github.com/ethereum/solidity/), the Solidity compiler.

##### Using Pip

```bash
pip3 install slither-analyzer
```

##### Using Git

```bash
git clone https://github.com/crytic/slither.git && cd slither
python3 setup.py install
```

We recommend using an Python virtual environment, as detailed in the [Developer Installation Instructions](https://github.com/trailofbits/slither/wiki/Developer-installation), if you prefer to install Slither via git.

##### Using Docker

Use the [`eth-security-toolbox`](https://github.com/trailofbits/eth-security-toolbox/) docker image. It includes all of our security tools and every major version of Solidity in a single image. `/home/share` will be mounted to `/share`  in the container.

```bash
docker pull trailofbits/eth-security-toolbox
```

To share a directory in the container:

```bash
docker run -it -v /home/share:/share trailofbits/eth-security-toolbox
```

#### Usage

```slither <file-name>.sol```

### 2. Mythril

Mythril detects a range of security issues, including integer underflows, owner-overwrite-to-Ether-withdrawal, and others. Note that Mythril is targeted at finding common vulnerabilities, and is not able to discover issues in the business logic of an application. Furthermore, Mythril and symbolic executors are generally unsound, as they are often unable to explore all possible states of a program.

Source: https://github.com/ConsenSys/mythril

#### How to install

```bash
$ docker pull mythril/myth
```

Install from Pypi:

nhoba
$ pip3 install mythril
```

Note: In my exprience, I prefer using mythril version installed via pip3 rather than Docker. I've faced so many issues with the docker version, and I decided to switch to pip3 one.

#### Usage

Via pip3: https://github.com/ConsenSys/mythril/blob/develop/README.md#usage

Via Docker: ```docker run -v $(pwd):/tmp mythril/myth a /tmp/<file-name>.sol --solv 0.5.0```

#### Issues

In case the tool gives you this error:

> mythril.mythril.mythril_disassembler [ERROR]: The file Token.sol does not contain a compilable contract.
> mythril.interfaces.cli [ERROR]: input files do not contain any valid contracts

We can use contract address in testnet or ganache
https://mythril-classic.readthedocs.io/en/master/security-analysis.html

Ganache: ```myth a --rpc ganache -a <address>```




